{"version":3,"sources":["../../../src/parse/tpdoc/jsdocParse.js"],"names":["deepStringify","refs","defObject","exist","result","forEach","ref","def","push","dependenceList","concat","jsdocParse","funDesc","parameters","responses","parameDocList","item","type","entityName","typeResult","replace","dependence","paramStr","name","comment","returnTypeResult","returnType","typedefNameList","paramsReturnLead","join"],"mappings":";;;;;;;AAAA;;AAEA,SAASA,aAAT,CAAuBC,IAAvB,EAA6BC,SAA7B,EAAwCC,KAAK,GAAG,EAAhD,EAAoD;AAClD,MAAIC,MAAM,GAAG,EAAb;AACAH,EAAAA,IAAI,CAACI,OAAL,CAAcC,GAAD,IAAS;AACpB,QAAI,CAACH,KAAK,CAACG,GAAD,CAAV,EAAiB;AACf,YAAMC,GAAG,GAAGL,SAAS,CAACI,GAAD,CAArB;AACAH,MAAAA,KAAK,CAACG,GAAD,CAAL,GAAa,IAAb;;AACA,UAAIC,GAAJ,EAAS;AACPH,QAAAA,MAAM,CAACI,IAAP,CAAYF,GAAZ;AACAF,QAAAA,MAAM,GAAGJ,aAAa,CAACO,GAAG,CAACE,cAAL,EAAqBP,SAArB,EAAgCC,KAAhC,CAAb,CAAoDO,MAApD,CAA2DN,MAA3D,CAAT;AACD;AACF;AACF,GATD;AAUA,SAAOA,MAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACe,SAASO,UAAT,CAAoBC,OAApB,EAA6BC,UAA7B,EAAyCC,SAAzC,EAAoDZ,SAApD,EAA+D;AAC5E,QAAMa,aAAa,GAAG,EAAtB;AACA,MAAId,IAAI,GAAG,EAAX,CAF4E,CAI5E;;AACAY,EAAAA,UAAU,CAACR,OAAX,CAAoBW,IAAD,IAAU;AAC3B,QAAIC,IAAI,GAAG,KAAX;AACA,UAAM;AACJC,MAAAA;AADI,QAEFF,IAFJ;AAGA,UAAMG,UAAU,GAAG,gCAAcD,UAAd,CAAnB;AACAD,IAAAA,IAAI,GAAGE,UAAU,CAACF,IAAlB;AACAhB,IAAAA,IAAI,CAACO,IAAL,CAAUS,IAAI,CAACG,OAAL,CAAa,QAAb,EAAuB,GAAvB,CAAV;AACAnB,IAAAA,IAAI,GAAGA,IAAI,CAACS,MAAL,CAAYS,UAAU,CAACE,UAAvB,CAAP;AACA,UAAMC,QAAQ,GAAI,cAAaL,IAAI,CAACG,OAAL,CAAa,QAAb,EAAuB,GAAvB,CAA4B,KAAIJ,IAAI,CAACO,IAAL,CAAUH,OAAV,CAAkB,IAAlB,EAAwB,EAAxB,CAA4B,IAAGJ,IAAI,CAACQ,OAAQ,EAA3G;AACAT,IAAAA,aAAa,CAACP,IAAd,CAAmBc,QAAnB;AACD,GAXD;AAaA,QAAMG,gBAAgB,GAAG,gCAAcX,SAAS,CAACI,UAAxB,CAAzB;AACA,QAAMQ,UAAU,GAAGD,gBAAgB,CAACR,IAAjB,CAAsBG,OAAtB,CAA8B,QAA9B,EAAwC,GAAxC,CAAnB;AACAnB,EAAAA,IAAI,CAACO,IAAL,CAAUkB,UAAV;AACAzB,EAAAA,IAAI,GAAGA,IAAI,CAACS,MAAL,CAAYe,gBAAgB,CAACJ,UAA7B,CAAP,CArB4E,CAuB5E;;AACA,QAAMM,eAAe,GAAG3B,aAAa,CAACC,IAAD,EAAOC,SAAP,CAArC;AAEA,QAAM0B,gBAAgB,GAAI;AAC5B;AACA,KAAKhB,OAAQ;AACb,EAAEG,aAAa,CAACc,IAAd,CAAmB,IAAnB,CAAyB;AAC3B,uBAAuBH,UAAW;AAClC,IALE;AAOA,SAAO;AACLE,IAAAA,gBADK;AAELD,IAAAA;AAFK,GAAP;AAID","sourcesContent":["import { translateType } from './definitions';\n\nfunction deepStringify(refs, defObject, exist = {}) {\n  let result = [];\n  refs.forEach((ref) => {\n    if (!exist[ref]) {\n      const def = defObject[ref];\n      exist[ref] = true;\n      if (def) {\n        result.push(ref);\n        result = deepStringify(def.dependenceList, defObject, exist).concat(result);\n      }\n    }\n  });\n  return result;\n}\n\n/**\n * 名字\n * @param {*} funDesc 方法描述\n * @param {*} parameters 方法参数信息\n * @param {*} responses 方法返回结果\n * @param {*} defObject typedef的固定结构内容\n */\nexport default function jsdocParse(funDesc, parameters, responses, defObject) {\n  const parameDocList = [];\n  let refs = [];\n\n  // 参数jsdoc解析\n  parameters.forEach((item) => {\n    let type = 'any';\n    const {\n      entityName,\n    } = item;\n    const typeResult = translateType(entityName);\n    type = typeResult.type;\n    refs.push(type.replace(/[<|>]/g, '_'));\n    refs = refs.concat(typeResult.dependence);\n    const paramStr = ` * @param {${type.replace(/[<|>]/g, '_')}} ${item.name.replace(/-/g, '')} ${item.comment}`;\n    parameDocList.push(paramStr);\n  });\n\n  const returnTypeResult = translateType(responses.entityName);\n  const returnType = returnTypeResult.type.replace(/[<|>]/g, '_');\n  refs.push(returnType);\n  refs = refs.concat(returnTypeResult.dependence);\n\n  // 被引用的typedef\n  const typedefNameList = deepStringify(refs, defObject);\n\n  const paramsReturnLead = `\n/**\n * ${funDesc}\n${parameDocList.join('\\n')}\n * @returns {Promise<${returnType}>}\n */`;\n\n  return {\n    paramsReturnLead,\n    typedefNameList,\n  };\n}\n"],"file":"jsdocParse.js"}